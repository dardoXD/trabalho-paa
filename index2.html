<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Trabalho de Projeto e Análise de Algoritmos</title>
    <script src="js/Chart.bundle.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/semantic.min.css">
    <script src="js/jquery-3.1.1.min.js"></script>
</head>
<body>
<div class="ui inverted stripe segment">
    <div class="ui centered grid">
        <div class="row">
            <div class="ui sixteen wide center aligned column">
                <h1 class="ui inverted header">Trabalho de Projeto e Análise de Algoritmos - 2016/2 - Algoritmos de
                    ordenação</h1>
            </div>
        </div>
        <div class="row">
            <div class="sixteen wide center aligned column">
                <form class="ui inverted form">
                    <div class="fields">
                        <div class="field" data-tooltip="Insira um valor para adicionar ao gráfico"
                             data-position="bottom left">
                            <input type="number" name="n1" id="n1" placeholder="Insira um valor">
                        </div>
                        <div class="field" data-tooltip="Adiciona o elemento inserido no campo à esquerda ao gráfico"
                             data-position="bottom center">
                            <input type="button" class="ui inverted button" onclick="adicionarElemento()"
                                   value="Adicionar elemento">
                        </div>
                        <div class="field" data-tooltip="Embaralha os dados atualmente presentes no gráfico"
                             data-position="bottom center">
                            <input type="button" class="ui inverted blue button" onclick="embaralharElementos()"
                                   value="Embaralhar dados">
                        </div>
                        <div class="field" data-tooltip="Remove o último elemento do gráfico"
                             data-position="bottom center">
                            <input type="button" class="ui inverted blue button" onclick="removerUltimoElemento()"
                                   value="Remover último">
                        </div>
                        <div class="field"
                             data-tooltip="Remove todos os elementos com o valor especificado no primeiro campo"
                             data-position="bottom center">
                            <input type="button" class="ui inverted blue button" onclick="removerElemento()"
                                   value="Remover especificado">
                        </div>
                        <div class="field" data-tooltip="Limpa os dados do gráfico atual" data-position="bottom center">
                            <input type="button" class="ui inverted blue button" onclick="limparGrafico()"
                                   value="Limpar tudo">
                        </div>
                        <div class="field" data-tooltip="Aumenta a velocidade das iterações do algoritmo"
                             data-position="bottom center">
                            <input type="button" class="ui inverted green button" onclick="aumentarVelocidade()"
                                   value="Mais rápido (atual: 1.5s)" id="aumentar_velocidade">
                        </div>
                        <div class="field" data-tooltip="Diminui a velocidade das iterações do algoritmo"
                             data-position="bottom center">
                            <input type="button" class="ui inverted green button" onclick="diminuirVelocidade()"
                                   value="Mais lento (atual: 1.5s)" id="diminuir_velocidade">
                        </div>
                    </div>

                    <div class="field">
                        <input type="button" class="ui huge teal inverted button" onclick="insertionSort()"
                               value="Ordenar com Insertion Sort">
                        <input type="button" class="ui huge teal inverted button" onclick="selectionSort()"
                               value="Ordenar com Selection Sort">
                    </div>
                </form>
            </div>
        </div>

        <div class="row">
            <div class="ui huge blue label" id="i">i</div>
            <div class="ui huge blue label" id="j">j</div>
            <div class="ui huge teal label" id="comparacao">Próxima Comparação</div>
        </div>

        <div class="row">
            <canvas id="myChart" width="400" height="130"></canvas>
        </div>

        <script type="application/javascript">

            dados = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];

            var delay = 1500;

            var azul = "rgba(54, 162, 235, 0.2)";
            var vermelho = "rgba(255, 0, 0, 0.5)";
            var amarelo = "rgba(255, 255, 0, 0.5)";
            var verde = "rgba(0, 255, 0, 0.5)";

            colors = [];

            for (i = 0; i < dados.length; i++) {
                colors.push(azul);
            }

            var ctx = document.getElementById("myChart");
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: dados,
                    datasets: [{
                        data: dados,
                        backgroundColor: colors,
                        borderColor: 'rgba(54, 162, 235, 1)'
                        ,
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    },
                    legend: {
                        display: false
                    }
                }
            });

            function aumentarVelocidade() {
                if (delay > 1000) {
                    delay -= 500;
                    document.getElementById("aumentar_velocidade").value = "Mais rápido (atual: " + delay / 1000 + "s)";
                    document.getElementById("diminuir_velocidade").value = "Mais lento (atual: " + delay / 1000 + "s)";
                } else {
                    document.getElementById("aumentar_velocidade").className = "ui inverted disabled button";
                }
            }

            function diminuirVelocidade() {
                delay += 500;
                document.getElementById("aumentar_velocidade").value = "Mais rápido (atual: " + delay / 1000 + "s)";
                document.getElementById("diminuir_velocidade").value = "Mais lento (atual: " + delay / 1000 + "s)";
            }

            function adicionarElemento() {
                dados.push(document.getElementById("n1").value);
                for (i = 0; i < dados.length; i++) {
                    colors.push(azul);
                }

                myChart.update();
            }

            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            function limparGrafico() {
                max = dados.length;
                limparGrafico2(max);
            }

            async function limparGrafico2(max) {
                for (i = 0; i < max; i++) {
                    dados.pop();
                    colors.pop();
                    await sleep(30);
                    myChart.update();
                }
            }

            function embaralharElementos() {
                for (var i = dados.length - 1; i > 0; i--) {
                    var j = Math.floor(Math.random() * (i + 1));
                    var aux = dados[i];
                    dados[i] = dados[j];
                    dados[j] = aux;
                }
                for (k = 0; k < dados.length; k++) {
                    myChart.data.datasets[0].backgroundColor[k] = azul;
                }
                myChart.update();
            }

            function removerElemento() {
                index = dados.indexOf(document.getElementById("n1").value);
                if (index > -1) {
                    dados.splice(index, 1);
                    colors.splice(index, 1);
                }
                myChart.update();
            }

            function removerUltimoElemento() {
                dados.pop();
                colors.pop();
                myChart.update();
            }

            async function insertionSort() {

                for (i = 1; i < dados.length; i++) {
                    j = i;

                    for (k = 0; k < dados.length; k++) {
                        myChart.data.datasets[0].backgroundColor[k] = azul;
                    }
                    myChart.data.datasets[0].backgroundColor[j] = amarelo;
                    await sleep(delay);
                    document.getElementById("i").innerHTML = "i = " + i;
                    document.getElementById("j").innerHTML = "j = " + j;

                    myChart.update();

                    while (j > 0 && dados[j - 1] > dados[j]) {

                        document.getElementById("i").innerHTML = "i = " + i;
                        document.getElementById("j").innerHTML = "j = " + j;
                        document.getElementById("comparacao").innerHTML =
                            "Próxima comparação: V[" + (j - 1) + "] > V[" + j + "] (" + dados[j - 1] + " > " + dados[j] + ")";

                        myChart.data.datasets[0].backgroundColor[j - 1] = vermelho;
                        myChart.data.datasets[0].backgroundColor[j] = vermelho;

                        if (i != 0) {
                            await sleep(delay);
                            myChart.update();
                        }

                        aux = dados[j];
                        dados[j] = dados[j - 1];
                        dados[j - 1] = aux;

                        myChart.data.datasets[0].backgroundColor[j - 1] = verde;
                        myChart.data.datasets[0].backgroundColor[j] = verde;

                        await sleep(delay);
                        myChart.update();

                        j--;

                        for (k = 0; k < dados.length; k++) {
                            myChart.data.datasets[0].backgroundColor[k] = azul;
                        }
                        myChart.data.datasets[0].backgroundColor[i] = amarelo;
                        myChart.data.datasets[0].backgroundColor[j - 1] = vermelho;
                        myChart.data.datasets[0].backgroundColor[j] = vermelho;
                    }
                }
                for (k = 0; k < dados.length; k++) {
                    myChart.data.datasets[0].backgroundColor[k] = verde;
                }
                myChart.update();
            }

        </script>

        <div class="ui inverted vertical footer segment">
            <div class="ui grid container">
                <div class="ui column">
                    <h3 class="ui inverted header">UNIVERSIDADE FEDERAL DE SÃO CARLOS<br>
                        Departamento de Computação<br>
                        Projeto e Análise de Algoritmos - 2016/2
                    </h3>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>